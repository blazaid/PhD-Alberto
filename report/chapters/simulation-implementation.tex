\chapter{Implementación en simulador}
\label{ch:simulation-implementation}

El entorno de simulación que nos ofrece \ac{sumo} nos permite recoger la práctica totalidad de información propuesta en el capítulo \nameref{ch:methodology} (ver tabla~\ref{tbl:main-variables}) con la excepción del entorno.

El problema es que la representación del entorno que nos ofrece \ac{sumo} está preprocesada, de tal manera que podemos acceder a toda esta información pero de una manera simple. Dicho de otro modo, en un entorno real no podemos saber, por ejemplo, que existe un coche en la posición $(x, y, z)$ de unas determinadas dimensiones\sidenote{
	En realidad sí que podríamos conseguir esa información con cierto grado de certeza, pero existe un porcentaje en el que no, y por tanto necesitamos que ambos entornos sean lo más parecidos posible.
}.

Por lo tanto, la solución por la que se ha optado es por la implementación de un \ac{lidar} en el vehículo simulado de tal manera que ofrece una nube de puntos de las mismas características que las capturadas por el \ac{lidar} físico y situado en la misma posición del vehículo.

\begin{marginfigure}
	\centering
	\includegraphics[width=\textwidth]{sumo-route}
	\caption[Dos recorridos de prueba en el entorno virtual]{Los dos recorridos generados para recoger los datos de los vehículos circulando con los modelos longitudinal y de cambio de carril implantados.}
	\label{fig:sumo-routes}
\end{marginfigure}

Una vez implementado el vehículo, dentro de la librería desarrollada se han implantado los modelos longitudinales y de cambio de carril dentro de un conductor virtual para el sujeto global y para cada uno de los sujetos del experimento y se han realizado dos recorridos de características similares a los recorridos de los que se han obtenido los conjuntos de test (ver Figura~\ref{fig:sumo-routes}).

La forma por la que se comprobará si los comportamientos son similares es la propuesta en \cite{DiazAlvarez2014} para el comportamiento longitudinal. En la tabla~\ref{tbl:global-comparison-indicators} se resumen estos valores para el modelo de conducción global y los conductores específicos. La leyenda de indicadores es la siguiente:

\begin{itemize}
	\item $V$. Velocidad instantánea del vehículo.
	\item $AP$/$AN$. Aceleración instantánea positiva y negativa del vehículo.
	\item $JIM$. Jerk\sidenote{El \textbf{jerk} es la derivada de la aceleración.} positivo con aceleración positiva, el cual se corresponde con la situación en la que el vehículo está iniciando la marcha (jerk de inicio de marcha).
	\item $JLC$. Jerk positivo con aceleración negativa, caso que se da cuando se está llegando a la velocidad deseada, por lo que aunque la velocidad sigue aumentando, lo hace en una tasa cada vez más decreciente (jerk de llegada a crucero).
	\item $JIF$. Jerk negativo con aceleración negativa, cuando el conductor inicia una maniobra de reducción de velocidad (jerk de inicio de frenada).
	\item $JFF$. Jerk positivo con aceleración negativa, que se corresponde con el moento en el que el conductor está terminando una manibra de frenada o de reducción de velocidad (jerk de fin de frenada).
\end{itemize}

Por otro lado, para el el comportamiento del modelo de cambio de carril se usará el número de éstos que se han producido durante el recorrido, ya que podemos considerar las condiciones similares (i.e. flujo de tráfico moderado en ambas direcciones, misma distancia de recorrido y aproximadamente el mismo número de carriles y semáforos durante el recorrido).

\begin{table}
	\centering
	\small
	\caption[Indicadores reales frente a indicadores capturados en simulación]{Resumen de los indicadores provenientes de los datos de los conductores en los recorridos frente a los valores. En el caso del conjunto global, se ha elegido la media truncada por entre el número de cambios que existen entre los tres sujetos como estimador del número de cambios de carril que haría el conductor medio en ese recorrido.}
	\label{tbl:global-comparison-indicators}
	\begin{tabular}{cccccccccc}
		\centering
		&                   & \multicolumn{2}{c}{$S_A$}    & \multicolumn{2}{c}{$S_1$}          & \multicolumn{2}{c}{$S_2$}        & \multicolumn{2}{c}{\textbf{$S_3$}}        \\
		\multicolumn{2}{l}{}                  & $\mu$     & $\sigma$ & $\mu$    & $\sigma$ & $\mu$     & $\sigma$  & $\mu$    & $\sigma$ \\
		\hline
		\multirow{2}{*}{\textbf{$V$}}   & R. & $3.868$  & $3.515$  & $5.823$  & $5.165$  & $4.246$  & $3.583$  & $2.415$  & $1.834$  \\
		                                & S. & $3.401$  & $3.003$  & $5.816$  & $4.996$  & $4.111$  & $3.515$  & $2.577$  & $2.050$  \\
		\multirow{2}{*}{\textbf{$AP$}}  & R. & $0.082$  & $0.201$  & $0.039$  & $0.029$  & $0.086$  & $0.260$  & $0.084$  & $0.040$  \\
		                                & S. & $0.042$  & $0.019$  & $0.058$  & $0.029$  & $0.039$  & $0.021$  & $0.060$  & $0.035$  \\
		\multirow{2}{*}{\textbf{$AN$}}  & R. & $-0.088$ & $0.144$  & $-0.087$ & $0.048$  & $-0.080$ & $0.173$  & $-0.110$ & $0.041$  \\
		                                & S. & $-0.050$ & $0.034$  & $-0.053$ & $0.043$  & $0.039$  & $0.024$  & $0.065$  & $0.038$  \\
		\multirow{2}{*}{\textbf{$JIM$}} & R. & $0.019$  & $0.084$  & $0.011$  & $0.011$  & $0.023$  & $0.112$  & $0.015$  & $0.013$  \\
		                                & S. & $0.007$  & $0.009$  & $0.009$  & $0.020$  & $0.008$  & $0.011$  & $0.007$  & $0.011$  \\
		\multirow{2}{*}{\textbf{$JLC$}} & R. & $0.032$  & $0.127$  & $0.019$  & $0.015$  & $0.039$  & $0.157$  & $0.016$  & $0.016$  \\
		                                & S. & $0.009$  & $0.018$  & $0.012$  & $0.024$  & $0.010$  & $0.019$  & $0.010$  & $0.017$  \\
		\multirow{2}{*}{\textbf{$JIF$}} & R. & $-0.023$ & $0.060$  & $-0.022$ & $0.019$  & $-0.026$ & $0.074$  & $-0.016$ & $0.014$  \\
		                                & S. & $-0.005$ & $0.010$  & $-0.003$ & $0.010$  & $-0.005$ & $0.008$  & $0.005$  & $0.013$  \\
		\multirow{2}{*}{\textbf{$JFF$}} & R. & $-0.035$ & $0.151$  & $-0.021$ & $0.022$  & $-0.045$ & $0.191$  & $-0.018$ & $0.027$  \\
		                                & S. & $-0.012$ & $0.023$  & $0.034$  & $0.047$  & $-0.011$ & $0.188$  & $-0.013$ & $0.027$  \\
		\multirow{2}{*}{\textbf{$LC$}}  & R. & $87$     &    -     & $43$     &    -     & $27$     &    -     & $51$     &    -     \\
		                                & S. & $63$     &    -     & $39$     &    -     & $21$     &    -     & $45$     &    -     \\
		\multirow{2}{*}{\textbf{$RC$}}  & R. & $7$      &    -     & $3$      &    -     & $7$      &    -     & $13$     &    -     \\
                                        & S. & $1$      &    -     & $1$      &    -     & $5$      &    -     & $9$      &    -     \\
        \hline
	\end{tabular}
\end{table}

La tabla~\ref{tbl:global-comparison-indicators} ofrece mucha información, por lo que la comentaremos por partes.

\section{Comportamiento en el modelo longitudinal}

En el caso de los modelos longitudinales, se puede observar que los valores de las velocidades medias se mueven alrededor de los mismos valores, por lo que podemos concluir que se pueden considerar similares en este comportamiento.

Para los datos de aceleración y \textit{jerk} hemos preferido mostrarlos de manera visual en la Figura~\ref{fig:lc-global-comparison-indicators}.

\TODO{Aquí figura}.

Podemos ver \TODO{Aquí pequeño discurso dependiendo de si se parecen o no}

\section{Comportamiento en el modelo de cambio de carril}

En el caso del modelo de cambios de carril, se pueden ver indicios de que el número de cambios de carril en la realidad se mantienen en el mismo rango aproximado que el número de cambios de carril de los modelos estimados, tanto para el general como para los específicos.

Otro detalle es que el número de cambios de carril es menor siempre en el modelo estimado. La razón creo que puede deberse a la baja proporción de cambios de carril respecto a los ejemplos donde éste no existe. Este hecho es muy patente en el caso de los cambios de carril a derechas (fila $RC$ de los indicadores de al tabla~\ref{tbl:global-comparison-indicators}).